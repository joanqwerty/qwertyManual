<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../../../img/favicon.ico" />
    <title>Segunda parte de Linux embebido en Orange Pi Zero 3 - QwertyManual</title>
    <link rel="stylesheet" href="../../../css/theme.css" />
    <link rel="stylesheet" href="../../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../../../css/extra.css" rel="stylesheet" />
        <link href="../../../assets/mkdocs_puml/puml.css" rel="stylesheet" />
        <link href="../../../assets/mkdocs_puml/interaction.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Segunda parte de Linux embebido en Orange Pi Zero 3";
        var mkdocs_page_input_path = "linux-development/orangepi/rootfs.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../../..">
          <img src="../../../assets/qwertyMan.png" class="logo" alt="Logo"/>
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption"><span class="caption-text">Inicio</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../..">Introducción</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Diseño de software</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../software-design/">Introducción al diseño de software</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../software-design/architecture/">Arquitectura de software</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../software-design/patterns/">Patrones de diseño</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Rational Unified Process</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../rup/">Introducción a RUP</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../rup/phases/">Fases del proceso</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../rup/uml/">UML</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../rup/views-4%2B1/">4+1 Vistas</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Linux Kernel Development</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../../">Guía de Desarrollo de Linux Embebido</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../linux-kernel-trees/">Estructura de ramas para el kernel de linux</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" >Linux embebido en Orange Pi Zero 3</a>
    <ul class="current">
                <li class="toctree-l2"><a class="reference internal" href="../orangepi-zero3/">Primera parte de Linux embebido en Orange Pi Zero 3</a>
                </li>
                <li class="toctree-l2 current"><a class="reference internal current" href="#">Segunda parte de Linux embebido en Orange Pi Zero 3</a>
    <ul class="current">
    <li class="toctree-l3"><a class="reference internal" href="#estructura-principal">Estructura principal</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#busybox">Busybox</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#iniciamos-la-compilacion">Iniciamos la compilación</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#creando-el-init">Creando el Init</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#instalando-modulos-del-kernel-en-el-rootfs">Instalando modulos del kernel en el rootfs</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#proximos-pasos">Próximos pasos</a>
    </li>
    </ul>
                </li>
    </ul>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../..">QwertyManual</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../.." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">Linux Kernel Development</li>
          <li class="breadcrumb-item">Linux embebido en Orange Pi Zero 3</li>
      <li class="breadcrumb-item active">Segunda parte de Linux embebido en Orange Pi Zero 3</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="segunda-parte-del-proyecto-linux-embebido-en-orangepi-zero-3-allwinner-h618-usando-docker">Segunda parte del proyecto Linux Embebido en OrangePi Zero 3 - Allwinner H618 usando Docker</h1>
<p>Aqui se continuará con la guia de desarrollo de Linux Embebido en la OrangePi Zero 3, en la sección anterior preparamos el entorno de trabajo y compilamos los dos primeros componentes del sistema:</p>
<ul>
<li>U-Boot (bootloader)</li>
<li>Kernel de Linux</li>
</ul>
<p>En esta ocasión nos centraremos en crear un <code>rootfs</code> que será nuestro sistema de archivos raíz donde formaremos la arquitectura de directorios convencional de Linux, ya agregremos el sistema de arranque y porgramas básicos apyandonos del proyecto <strong>Busybox</strong>.</p>
<h2 id="estructura-principal">Estructura principal</h2>
<p>Nos dirigeremos a nuestra carpeta principal del proyecto, y crearemos el directorio raíz <code>rootfs</code></p>
<pre><code class="language-bash">mkdir -p rootfs
</code></pre>
<p>Las carpetas se verian asi:</p>
<pre><code>  arm-trusted-firmware linux-orangepi rootfs u-boot
</code></pre>
<p>Despues entramos a este nuevo directorio.</p>
<pre><code class="language-bash">cd rootfs
</code></pre>
<p>Creamos la estructura de directorios</p>
<pre><code class="language-bash">mkdir -p {dev,proc,sys,etc,bin,sbin,tmp,usr/{bin,sbin},var,home}
chmod 1777 tmp
</code></pre>
<p>Creamos dispositivos basicos en <code>dev</code>.</p>
<p>Estando dentro de <code>rootfs</code> nos dirigimos a la capeta <code>dev</code> creada en el paso anterior, y ahí creamos los dispositivos principales.</p>
<pre><code class="language-bash">cd dev
sudo mknod -m 622 console c 5 1
sudo mknod -m 666 null c 1 3
</code></pre>
<p>Estos dispositivos son necesarios para el funcionamiento de nuestro sistema, de lo contrario no podrá arrancar.</p>
<h2 id="busybox">Busybox</h2>
<p>Ahora volvemos a la raiz de nuestro proyecto y descargaremos busybox desde su repositorio.</p>
<pre><code class="language-bash">git clone https://github.com/mirror/busybox.git --depth 1
cd busybox
</code></pre>
<p>Esto descargará el proyecto y nos pondrá dentro del directorio.</p>
<p>El siguiente paso es crear la configuración.</p>
<pre><code class="language-bash">make defconfig
make menuconfig
</code></pre>
<p>Dentro del menu editamos la configuración, debemos activar la compilación estatica para no tener problema de dependencias.</p>
<pre><code>Settings → Build static binary (no shared libs)
</code></pre>
<p>La activamos dando la tecla <code>[space]</code>.</p>
<p><img alt="busybox menu" src="../../../assets/orangepi-z3/busybox-menu.png" /></p>
<p>Tambien debemos desactivar la opcion de aceleración SHA1.</p>
<p><img alt="sha1 menu" src="../../../assets/orangepi-z3/sha1-menu.png" /></p>
<p>Salimos y guardamos.</p>
<h3 id="iniciamos-la-compilacion">Iniciamos la compilación</h3>
<p>El proceso puede durar algunos minutos dependiendo de tu maquina.</p>
<pre><code class="language-bash">make ARCH=arm64 CROSS_COMPILE=aarch64-linux-gnu- -j$(nproc)
</code></pre>
<p>Si el proceso fue exitoso instalamos busybox en nuestro <code>rootfs</code>.</p>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>Asegurate que la ruta del rootfs sea la correcta, de lo contrario podria no instalarse o crear problemas.</p>
</div>
<pre><code class="language-bash">make ARCH=arm64 CROSS_COMPILE=aarch64-linux-gnu- INSTALL_MOD_PATH=../rootfs-arm64 modules_install
</code></pre>
<p>Ahora en nuestro directorio <code>rootfs</code> deberiamos tener instalado busybox, puedes comprobarlo, deberias tener este archivo.</p>
<pre><code>rootfs/bin/busybox
</code></pre>
<h2 id="creando-el-init">Creando el Init</h2>
<p>Dentro de tu <code>rootfs</code>, crea un archivo init en la raiz principal.</p>
<pre><code class="language-bash">cd rootfs
touch init
</code></pre>
<p>Ahora abrimos con el editor este archivo y agregamos el siguiente contenido inicial.</p>
<pre><code>#!/bin/sh
# Montar sistemas de archivos necesarios
mount -t proc proc /proc
mount -t sysfs sysfs /sys
mount -t devtmpfs devtmpfs /dev

# Mensaje de inicio
echo &quot;Iniciando sistema...&quot;

# Lanzar shell interactiva
exec /bin/sh
</code></pre>
<p>Este script sera el proceso principal con el cual vamos a interactuar.</p>
<p>Hacemos el <code>init</code> ejecutable.</p>
<pre><code class="language-bash">chmod +x init
</code></pre>
<h2 id="instalando-modulos-del-kernel-en-el-rootfs">Instalando modulos del kernel en el rootfs</h2>
<p>Nos dirigimos a la carpeta <code>linux-orangepi</code> y ejecutamos el siguiente comando, de la misma manera debemos asegurarnos que la ruta del <code>rootfs</code> sea la correcta</p>
<pre><code class="language-bash">make ARCH=arm64 CROSS_COMPILE=aarch64-linux-gnu- modules_install INSTALL_MOD_PATH=../rootfs
</code></pre>
<h2 id="proximos-pasos">Próximos pasos</h2>
<p>En la siguiente sección veremos como crear la configuracion para el aranque y empaquetar todo para tener nuestro sistema Linux embebido listo para ejecutar en nuestra OrangePi Zero 3.</p>
<!-- ## Compilar boot.cmd

```bash
mkimage -C none -A arm64 -T script -d boot.cmd boot.scr
``` -->
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../orangepi-zero3/" class="btn btn-neutral float-left" title="Primera parte de Linux embebido en Orange Pi Zero 3"><span class="icon icon-circle-arrow-left"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../orangepi-zero3/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
  </span>
</div>
    <script src="../../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../../..";</script>
    <script src="../../../js/theme_extra.js"></script>
    <script src="../../../js/theme.js"></script>
      <script src="../../../search/main.js"></script>
      <script src="../../../assets/mkdocs_puml/puml.js"></script>
      <script src="https://unpkg.com/@panzoom/panzoom@4.5.1/dist/panzoom.min.js"></script>
      <script src="../../../assets/mkdocs_puml/interaction.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
